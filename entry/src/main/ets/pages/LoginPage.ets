import { LoginViewModel } from '../viewmodel/LoginViewModel'

@Entry
@Component
struct LoginPage {
  /**
   * å½“å‰çš„ç™»å½•æ¨¡å¼,æ˜¯ä¸æ˜¯è´¦å·å¯†ç ç™»å½•
   */
  @State currentLoginTypeIsPassword: boolean = false
  @State userNameplaceholder: string = 'è¯·è¾“å…¥æ‰‹æœºå·'
  @State passwordplaceholder: string = 'è¯·è¾“å…¥éªŒè¯ç '
  @State userNameErrorMessage: string = ''
  @State passwordErrorMessage: string = ''
  @State userName: string = ''
  @State password: string = ''
  viewModel: LoginViewModel

  aboutToAppear() {
    this.viewModel = new LoginViewModel();
  }

  build() {
    Column() {
      Text('ç¥TMå¿«é€’')
        .fontSize(18)
        .margin({ top: 20 })
        .fontWeight(600)
        .width('100%')
        .textAlign(TextAlign.Center)

      Row() {
        Text(this.currentLoginTypeIsPassword ? 'è´¦å·ç™»å½•' : 'æ‰‹æœºå·ç™»å½•').fontSize(24)
        Text(!this.currentLoginTypeIsPassword ? 'è´¦å·ç™»å½•ğŸ‘‰' : 'æ‰‹æœºå·ç™»å½•ğŸ‘‰').fontSize(16).onClick(() => {
          this.currentLoginTypeIsPassword = !this.currentLoginTypeIsPassword
          if (this.currentLoginTypeIsPassword) {
            this.userNameplaceholder = 'æ¸…è¾“å…¥è´¦å·'
            this.passwordplaceholder = 'æ¸…è¾“å…¥å¯†ç '
          } else {
            this.userNameplaceholder = 'è¯·è¾“å…¥æ‰‹æœºå·'
            this.passwordplaceholder = 'è¯·è¾“å…¥éªŒè¯ç '
          }
          this.userName = ''
          this.password = ''
        }).fontColor($r('app.color.primary'))
      }.width('100%').margin({ top: 50 }).justifyContent(FlexAlign.SpaceBetween)

      TextInput({ placeholder: this.userNameplaceholder, text: this.userName })
        .textInputStyle(11, 55)
        .onChange((content: string) => {
          this.userName = content
        })
      Text(this.userNameErrorMessage).margin({ top: 13 }).fontColor($r('app.color.primary'))
        .visibility(this.userNameErrorMessage === '' ? Visibility.Hidden : Visibility.Visible)
      Stack({ alignContent: Alignment.End }) {
        TextInput({ placeholder: this.passwordplaceholder, text: this.password })
          .textInputStyle(this.currentLoginTypeIsPassword ? 10 : 4, 20, this.currentLoginTypeIsPassword ? InputType.Password : InputType.Number)
          .onChange((content: string) => {
            this.password = content
          }).showPasswordIcon(this.currentLoginTypeIsPassword)
        Divider()
          .height(26)
          .width(10)
          .color($r('app.color.border'))
          .vertical(true)
          .margin({ right: 100, top: 15 })
          .visibility(this.currentLoginTypeIsPassword ? Visibility.None : Visibility.Visible)
        Text('è·å–éªŒè¯ç ')
          .margin({ right: 15, top: 15 })
          .fontSize(14)
          .visibility(this.currentLoginTypeIsPassword ? Visibility.None : Visibility.Visible)
      }

      Text(this.passwordErrorMessage).margin({ top: 13 }).fontColor($r('app.color.primary'))
        .visibility(this.passwordErrorMessage === '' ? Visibility.Hidden : Visibility.Visible)

      Button('ç™»å½•')
        .width('100%')
        .margin({ top: 20 })
        .height(50)
        .backgroundColor($r('app.color.primary'))
        .enabled(this.viewModel.checkUserNameAndPassword(this.userName, this.password))
        .onClick(() => {
          this.viewModel.login(this.userName, this.password)
        })
    }.width('100%').height('100%').alignItems(HorizontalAlign.Start).padding({ left: 33, right: 33 })
  }
}

@Extend(TextInput)
function textInputStyle(maxLength: number, topMargin: number, inputType?: InputType) {
  .maxLength(maxLength)
  .type(inputType ?? InputType.Normal)
  .borderWidth({ bottom: 1 })
  .borderRadius(0)
  .padding({ left: 0 })
  .margin({ top: topMargin })
  .stateStyles({
    focused: textInputFocused,
    normal: textInputNormal,
    //ä¸è®¾ç½®è¿™ä¸ªä¼šå¯¼è‡´æ–‡æœ¬æ¡†ç‚¹å‡»çš„æ—¶å€™æœ‰ç°è‰²èƒŒæ™¯, çœ‹å®˜æ–¹æ–‡æ¡£, æš‚æ—¶æ²¡æœ‰è§£å†³æ–¹æ¡ˆ
    pressed: textInputFocused
  })
}

@Styles
function textInputFocused() {
  .borderColor($r('app.color.primary'))
  .backgroundColor(Color.White)
}

@Styles
function textInputNormal() {
  .borderColor($r('app.color.border'))
  .backgroundColor(Color.White)
}